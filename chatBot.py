# -*- coding: utf-8 -*-
"""custom-chatbot.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/gist/SaharaiR/224598290b82bf9e015a0bf03af77515/custom-chatbot.ipynb

# Project 2: Building a Chatbot with OpenAI's ChatCompletion API

In this exciting section of our course, we'll be turning our attention to the creation of a custom chatbot using OpenAI's ChatCompletion API. This project will showcase the capabilities of the OpenAI language model in understanding and responding to user input in a conversational manner. You'll learn how to harness the power of advanced AI to create a chatbot that can converse with users on a wide range of topics, providing responses that are both relevant and contextually appropriate.

## What You Will Learn

- **ChatCompletion API Fundamentals**: Discover the features of the ChatCompletion API and how it can be utilized to create responsive and intelligent chatbots.
- **Conversation Handling**: Understand the intricacies of managing a conversation flow and maintaining context within a chat session.

## Preparation

Before jumping in, please ensure you have:

- A Google Colab account ready for use.
- Intermediate proficiency in Python programming.
- An active OpenAI API key (sign up at [OpenAI](https://platform.openai.com/account/api-keys) if you haven't already).

## Time to Create

Let's build chatbots! By the end of this project, you'll have a fully functional chatbot ready to engage with users, powered by ChatCompletion API from OpenAI!

# 2. Libraries import
"""

!pip install openai

import os
import openai

from openai import OpenAI

"""# 3. Sending a first ChatMessage to ChatGPT 3.5 or 4 via  OpenAI API


### 3.1 Setting up API Key
"""

os.environ["OPENAI_API_KEY"] = ""
client = OpenAI()

"""## 3.2 Sending the requests"""

client.chat.completions.create(
    model = "gpt-3.5-turbo",
    messages = [
        {"role": "system", "content": "You are a helpful assistant."},

        {"role": "user", "content": "How tall is the tallest building in the world"}
    ],
    temperature = 0.9,
    max_tokens = 300
)

"""# 4. Building our custom chatbot with OpenAI API"""

messages_buffer = []
while True:
  user_input = input("User: ")

  if user_input == "q":
    break

  response = client.chat.completions.create(
      model = "gpt-3.5-turbo",
      messages = [
          {"role": "system", "content": "You are a helpful assistant."},
          {"role": "user", "content": user_input}
      ],
      temperature = 0.9,
      max_tokens = 50
  )
  print("Assistant: ", response.choices[0].message.content)

"""## 4.1 Adding memory to our chatbot"""

messages_buffer = [{"role": "system", "content": "You are a helpful assistant."}]
while True:
  user_input = input("User: ")

  if user_input == "q":
    break

  messages_buffer.append({"role": "user", "content": user_input})
  response = client.chat.completions.create(
      model = "gpt-3.5-turbo",
       messages = messages_buffer,
      temperature = 0.9,
      max_tokens = 50
  )
  messages_buffer.append({"role": "assistant", "content": response.choices[0].messsage.content})
  print("Assistant: ", response.choices[0].message.content)

"""### 4.2 Getting chatbot to answer based on our document/text"""

# Document URL: https://info.undp.org/erecruit/documents/FAQ.pdf
dataset="""Document content:
Question: What is UNDP’s eRecruit system? Answer: UNDP’s eRecruit system is an online system that allows applicants to create a personal profile that can be updated regularly in order to submit applications for more than one advertised UNDP job posting.
Question: How do I access UNDP’s eRecruit system? Answer: UNDP’s eRecruit system can be accessed through the following link: https://undpcareers.partneragencies.org/erecruit.html
Question: What is process for applying for a job using UNDP’s eRecruit system? Answer: Application Process Application Process
Question: Do I have to apply on-line using UNDP’s eRecruit system? Answer: All applications must be submitted online using UNDP’s eRecruit system. Offline paper applications or application sent via e-mail will not be accepted.
Question: What browsers are compatible with UNDP’s eRecruit system?Answer: UNDP’s eRecruit system was optimised for Google Chrome, Internet Explorer 6 and above. The usage of Internet Explorer 9 is required in compatibility view mode. We suggest that you use one of these browsers to make sure your application is submitted successfully.
Question: I am having problems logging into my profile. The browser is not responding. What should I do? Answer: If you are having problems logging in to your UNDP eRecruit profile in order to apply for a job opening this could stem from a number of reasons, some of which - such as internet connectivity - are outside of UNDP’s control. However, we suggest that you follow these instructions in order to address these types of issues: • Check that you are using the recommended browsers (and versions). • Clear your cache/browser history. You can find information about how to clear your browser history at http://www.refreshyourcache.com/en/home. Please make sure that you are aware of the consequences when clearing the cache in your browser before taking this action.
Question: What if I need help using UNDP’s eRecruit system? Answer: For general inquiries or assistance in using UNDP’s eRecruit system, please contact the HelpDesk at https://info.undp.org/sas/erecruit/Assets/HelpDesk.aspx.
Question: Why do I need to register? Answer: It is required that all applicants must first register in UNDP’s eRecruit system. After your registration is complete, a personal account is created so that you may complete your personal information and apply to advertised job postings.
Question: When registering, what should I use as my username? Answer: It is suggested that you should use a valid e-mail address as your username when registering in the UNDP’s eRecruit system.
Question: What password format is accepted? Answer: UNDP encourages the use of strong passwords. Passwords should be a minimum of 8 characters in length and contain a combination of letters and numbers.
Question: How can I change my password? Answer: Select the ‘Change Password’ option from the ‘Personal Information’ link after you have logged in to the system. Click on the ‘Forgot User Name or Password?’ link and follow the instructions to retrieve your forgotten password.
Question: I have forgotten my password. What should I do? Answer: If you have forgotten your password, click on the link Forgot User ID or Password and complete one of the two options.
Question: Will my data be secure? Answer: UNDP’s eRecruit data is stored on a private secure database and UNDP is the owner of the data. The system meets the UNDP's stringent security requirements.
Question: Do I have to complete all of the information in each of the sections? Answer: All fields marked with an asterisk (*) are required information and must be completed for each section.
Question: Do I need to complete all of the information in one session? Answer: You can save your application at any time during the application process and continue at a later time. When completing a section, we encourage that you use the save button regularly in order to ensure that your information is not lost.
Question: How do I select dates using the calendar feature? Answer: Dates can be selected in two ways. You can either A) type the date directly in the field using the dd/mm/yyyy format or B) select the date by clicking on the calendar icon and choose the year month and day.
Question: What should I do if my relevant information is not included in one of the drop-down options? Answer: You will be required to choose from the available drop-down options. Please choose the option that is the closest to your personal information, skills and experience.
Question: How do I use the Look-up feature? Answer: To use the Look-up feature, click on the magnifying glass icon. After, type in either the full or partial value in the given field and click the button Look Up. Lastly, select the appropriate value from the search result.
Question: Is there a spell check feature available? Answer: For various text description fields in each section, a spell click feature is available. To use the spell check feature, click on the dictionary icon to the left of the text field where available.
Question"  Can I apply to a job posting even if I do not meet the minimum requirements? Answer: You will not be able to apply to a job posting if your relevant education, work experience, language skills and possible other qualifications do not meet the minimum requirements specified in the job posting.
Question:  Can I review my application before submission? Answer: Once you have clicked on the button submit my application, you will be able to review your full application details before the final submission. If you wish to modify any of the details displayed on the Application Preview page, you may do so by returning to the previous page.
Question: How do submit my application? Answer: You will first need to complete all of the required information in the personal profile sections and answer the relevant job-related questions. After, you will be able to submit your application by clicking the button submit my application.
Question: The deadline for submitting an application has expired. Can I still apply? Answer: It is essential to submit your application in the eRecruit system before midnight CET time of the job posting’s closing date. Regrettably, we are unable to accept late applications.
Question: After I submit my application, will I receive a confirmation? Answer: After you have submitted your application online, you will receive an automated email confirming receipt of your application.
Question: Can I revise or amend my application once it has been submitted? Answer: You are able to revise or amend any sections of your personal profile before the job posting’s closing date. Please note that the closing date of all UNDP job postings are effective midnight, CET time.
Question: What if I want to submit additional documents to my application? Answer: UNDP does not require that you attach additional documents to your application. However, at any time during the recruitment process, you may be requested by a UNDP Recruitment Specialist to submit additional validating documents to your personal profile in support of your application. If you receive a request to upload specific documents, first navigate to the Careers Home page  My Career Tools page. Click on Applicant Attachments and add the relevant documents in the attachments section.
Question: Can I apply for more than one job posting at the same time? Answer: You may apply to multiple UNDP job postings given that you meet the minimum requirements for each.
Question: Is there a fee for submitting my application? Answer: UNDP does not charge any fee at any stage of the recruitment process whether at the application, interview, processing or training stage. UNDP does not require or need to know any information relating to the bank account details of applicants. Any such request should be rejected as these schemes are fraudulent.
Question: How can I check on the status of my application? Answer: At all times, you may view the status of the vacancies you have applied. To do so, navigate to the Careers Home page  My Career Tools  Applications page. On the My Applications page, you will be able to view the Recruiting Status for each of your applications.
"""

messages_buffer = [{"role": "system", "content": """I want you to act as a support agent. Your name is "My Super Assistant". You will provide me with answers from the given info. If the answer is not included, say exactly "Ooops! I don't know that." and stop after that. Refuse to answer any question not about the info. Never break character."""}]
messages_buffer.append({"role": "user","content": dataset})
while True:
  user_input = input("User: ")

  if user_input == "q":
    break

  messages_buffer.append({"role": "user", "content": user_input})
  response = client.chat.completions.create(
      model = "gpt-3.5-turbo",
       messages = messages_buffer,
      temperature = 0,
      max_tokens = 200
  )
  messages_buffer.append({"role": "assistant", "content": response.choices[0].messsage.content})
  print("Assistant: ", response.choices[0].message.content)
